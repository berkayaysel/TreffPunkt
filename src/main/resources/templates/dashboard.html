<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TreffPunkt Dashboard</title>
    
    <link rel="stylesheet" href="../static/dashboard.css">
</head>
<body>

    <div class="navbar">
        <a href="/treffpunkt/new-activity" class="nav-btn">+</a>

        <a href="/treffpunkt/profile" class="nav-btn profile-btn">Profil</a>
    </div>

    <div class="container" id="activity-container">
        
        <div id="loading-msg" style="text-align:center; color:#666; margin-top:20px;">
            Aktiviteler yÃ¼kleniyor...
        </div>

        <div class="empty-message" id="no-activity-msg" style="display: none;">
            HenÃ¼z hiÃ§ aktivite yok. <br>
            YukarÄ±daki <b>+</b> butonuna basarak ilk aktiviteyi sen oluÅŸtur!
        </div>

        </div>

    <script>
        // Sayfa tamamen yÃ¼klendiÄŸinde Ã§alÄ±ÅŸÄ±r
        window.onload = function() {
            fetchActivities();
        };

        function fetchActivities() {
            // BURASI Ã–NEMLÄ°: Backend'de tÃ¼m aktiviteleri getiren endpoint adresi.
            // EÄŸer ActivityController iÃ§inde @GetMapping("/all") yazdÄ±ysan adres budur:
            // (HenÃ¼z yazmadÄ±ysan backend tarafÄ±nda eklemen gerekir)
            const url = 'http://localhost:8080/user-dashboard/all'; 

            fetch(url)
                .then(response => {
                    // YÃ¼kleniyor yazÄ±sÄ±nÄ± gizle
                    document.getElementById('loading-msg').style.display = 'none';

                    if (!response.ok) {
                        throw new Error('Veri Ã§ekilemedi veya Backend kapalÄ±');
                    }
                    return response.json();
                })
                .then(activities => {
                    const container = document.getElementById('activity-container');
                    const emptyMsg = document.getElementById('no-activity-msg');

                    // EÄŸer gelen liste doluysa
                    if (activities && activities.length > 0) {
                        emptyMsg.style.display = 'none';

                        // Her aktivite iÃ§in dÃ¶ngÃ¼
                        activities.forEach(activity => {
                            // Backend'den gelen verileri HTML'e gÃ¶mÃ¼yoruz
                            // activity.id, activity.title, activity.date gibi isimler
                            // senin DTO veya Entity sÄ±nÄ±fÄ±ndaki isimlerle AYNI olmalÄ±!
                            const cardHTML = `
                                <div class="activity-card">
                                    <div class="activity-title">${activity.title || 'BaÅŸlÄ±ksÄ±z Aktivite'}</div>
                                    <div class="activity-info">ğŸ“… ${formatDate(activity.date)}</div>
                                    <div class="activity-info">ğŸ“ ${activity.location || 'Konum yok'}</div>
                                    
                                    <a href="/treffpunkt/activity-detail?id=${activity.id}" class="detail-btn">Detay</a>
                                </div>
                            `;
                            // KartÄ± listeye ekle
                            container.innerHTML += cardHTML;
                        });
                    } else {
                        // Liste boÅŸsa "Yok" mesajÄ±nÄ± gÃ¶ster
                        emptyMsg.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.log("Hata:", error);
                    document.getElementById('loading-msg').style.display = 'none';
                    // Hata durumunda da boÅŸ mesajÄ± gÃ¶sterelim ki sayfa bozuk durmasÄ±n
                    document.getElementById('no-activity-msg').style.display = 'block';
                });
        }

        // Tarih formatÄ±nÄ± dÃ¼zeltmek iÃ§in kÃ¼Ã§Ã¼k bir yardÄ±mcÄ± fonksiyon
        // Gelen tarih: "2025-12-10T14:30:00" -> Ã‡Ä±kan: "10.12.2025 14:30"
        function formatDate(dateString) {
            if (!dateString) return "";
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR') + ' ' + date.toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'});
        }
    </script>

</body>
</html>